# 浏览器工作原理 — HTML 解析与 CSS 计算 学习笔记 
> 上一课我们完成了从 HTTP 发送 Request，到接收到 Response，并且把 Response 中的文本都解析出来。这节课来实现html的解析和css计算部分


## 1. HTML 解析
### 1.1 拆分文件

> 第一步做一些文件的拆分和接口的设计
> 我们在得到Response后把body传给parseHTML解析，在真正的浏览器当中，我们应该是逐段的返回Response的body的，在这里我们直接收回全部body，这个api主要是将body传给parseHTML然后解析成dom树结构
- 为了方便文件管理，我们把 parser 单独拆分到文件中
- parser 接收 HTML 文本作为参数，返回一棵 DOM 树

### 1.2 用有效状态机 (FSM) 实现 HTML的分析
> HTML 标准里面已经把整个状态机中的状态都设计好了，我们直接就看HTML标准中给我们设计好的状态：https://html.spec.whatwg.org/multipage/，我们直接翻到 “Tokenization” 查看列出的状态，这里就是所有 HTML 的词法
- 我们用 FSM 来实现 HTML 的分析
- 在 HTML 标准中，已经规定了 HTML 的状态
- 我们的浏览器只挑选其中一部分状态，完成一个最简版本

### 1.3 解析标签
> HTML中有三种标签：开始标签、结束标签、自封闭标签
- 主要的标签有：开始标签，结束标签和自封闭标签
- 在这一步我们暂时忽略属性

### 1.4 创建元素
> 首先我们需要建立一个 currentToken 来暂存当前的 Token（这里我们是用于存放开始和结束标签 token 的）
然后建立一个 emit() 方法来接收最后创建完毕的 Token（这里后面会用逐个 Token 来创建 DOM 树）
- 在状态机中，除了状态迁移，我们还会加入业务逻辑
- 我们在标签结束状态提交标签 token
### 1.5 处理属性
- 属性值分为单引号、双引号、无引号三种写法，因此需要较多状态处理
- 处理属性的方式跟标签类似
- 属性结束时，我们把属性加到标签 Token 上